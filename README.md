Creating and releasing a Play 2 module
======================================

The sections below describe the steps required to create and release a Play 2 module along with a corresponding sample application:

* The steps are based on how <a href="http://sant0s.github.io/play2-chart/" target="_blank">Play 2 Chart</a> was created
* Some steps may be redundant or missing
* The order of the steps is not strict i.e. some steps may be executed earlier/later than specified
* Some steps may vary according to user preferences (e.g. preferred text editor)
* `<>` refers to a placeholder (e.g. `<module>` is a placeholder for a module name)
* Linux, Eclipse and Play 2.3 are assumed to be part of the development environment
  * These instructions may also work for Play versions above 2.4 (not tested)
* UNIX commands are assumed to take place on the path determined by the most recently executed `cd` command

Create module
-------------

1. Create module: `activator new`
  - Template: play-java
  - Name: `<module>`
      - In Play 1, the module name must match regex `[a-zA-Z]+`
1. Move module to `project-code` subdirectory
  1. `mkdir project-code`: this is the module's directory/Git repository
  1. `mv * project-code`
  1. `cd project-code`
1. Delete unnecessary content/files/directories:
  1. `vi conf/application.conf`: delete all content
  1. `vi project/plugins.sbt`: remove unnecessary plugins
  1. Remove unnecessary files/directories. Examples:
    - `public` or its subdirectories
    - `test/resources`
1. `vi .gitignore`: include files specified in [Appendix A](#appendixa)
1. `rm conf/routes`
1. Build module
  1. `activator`
    1. `run`
    1. Access `localhost:9000` on a browser and fix any compilation issues
1. Eclipsify module
  1. `activator`
    1. `eclipse`
1. Import module project into Eclipse:
  - `File -> Import -> General -> Existing Project into Workspace`
1. Set up module
  1. Delete README
  1. Create README.md
  1. Set name, version (start with `0.1.0`), organisation and dependencies in `build.sbt`
1. Implement the module
  1. Delete the `views` package under `app` if the module won't provide views
  1. Delete the `controllers` package under `app` if the module won't provide controllers
  1. Add code to package `<package>.<project>` under `app`
  1. Write and execute tests: `activator test`
  1. Check that no code problems are reported by Eclipse
  1. Check that no unnecessary logging is generated by the module (search the code for `Logger`)
1. Document the module
  1. Document all API methods using Javadoc
  1. `activator publishLocal`: Javadoc is generated under `target`
  1. Check that:
    1. All public API methods are documented
    1. No module related Javadoc errors are found in log files (under the `logs` directory)
  1. Add full documentation to `README.md`
1. Publish module to local Ivy repository
  1. `activator`
    1. `clean`
    1. `publishLocal`: the module gets published under `~/.ivy2/local`

Create module sample application
--------------------------------

1. Create a directory for sample applications at the same level as `project-code`: `mkdir samples`
1. `cd samples`
1. `activator new`
  - Template: `play-java`
  - Name: `<module>-sample`
1. `cd <module>-sample`
1. Configure the sample application
  1. Delete README
  1. Add full documentation to README.md
  1. Set name, version (start with 0.1.0, it should be in sync with the module one) and dependency to the module in `build.sbt`
1. Delete unnecessary files/directories. Examples:
  - `public` or its subdirectories
  - `test/resources`
1. `vi .gitignore` and include files specified in [Appendix A](#appendixa)
1. Eclipsify module sample application
  1. `activator`
    1. `eclipse`
1. Import module sample project into Eclipse:
  - `File -> Import -> General -> Existing Project into Workspace`
1. Implement the module
  1. Add code to under `app`
  1. Write and execute tests: `activator test`
  1. Test manually at `localhost:9000`
  1. Check that no code problems are reported by Eclipse

Release module
--------------

1. Test module before publishing to GitHub
  1. Remove module from `.ivy2/local` and `.ivy2/cache`
  1. `cd project-code`
  1. `activator`
    1. clean
    1. reload
    1. update
    1. Publish locally: publishLocal
      1. check that module is at `.ivy2/local` and not at `.ivy2/cache`
      1. Check that no unnecessary files/directories exist under `~/.ivy2/local/<package>/<module>. If any, remove them and republish. Examples of unnecessary files/directories include:
        - Files: `.classpath`, `.project`, `.gitignore`
        - Directories: `.settings`, `eclipse`, `javadoc`, `logs`, `.git`, empty directories (e.g. public)
    1. test: all tests should pass
1. Test module sample application against locally published module
  1. `cd samples/<module>-sample`
  1. `activator`
    1. `clean`
    1. `reload`
    1. `update`
    1. `test`: all tests should be ok
    1. `run` and test manually
1. Create a release repository and push it to GitHub
  1. Create a directory for the release repository outside the project one: `mkdir ~/release`
  1. Add built module to it: `cp -rv ~/.ivy2/local/<package>/<project*> ~/release`
  1. `cd release`
  1. Add/commit release files to local Git repository: see [Appendix B](#appendixb)
  1. Create GitHub release repository: see [Appendix C](#appendixc)
  1. Push release files from local Git repository to GitHub release repository: see [Appendix D](#appendixd)
1. Test module sample application against GitHub published module
  1. Remove module from .ivy2/local and .ivy2/cache
  1. `cd samples/<module>-sample`
  2. `vi build.sbt` and include GitHub release repository in `resolvers`
  3. `activator`
    1. `clean`
    1. `reload`
    1. `update`
    1. `test`: all tests should be ok
    1. `run` and test manually
1. Publish module in GitHub
  1. Add/commit module files to local Git repository: see [Appendix B](#appendixb)
  1. Create GitHub module repository: see [Appendix C](#appendixc)
  1. Push module files from local Git repository to GitHub module repository: see [Appendix D](#appendixd)
1. Publish module sample in GitHub
  1. Add/commit module sample files to local Git repository: see [Appendix B](#appendixb)
  1. Create GitHub module sample repository: see [Appendix C](#appendixc)
  1. Push module sample files from local Git repository to GitHub module sample repository: see [Appendix D](#appendixd)
1. Create module web page in GitHub: see [Appendix E](#appendixe)
1. Announce the module on the play-framework Google Group using the e-mail template specified in [Appendix F](#appendixf)

<a name="appendixa"></a>Appendix A - `.gitignore`
---------------------------------------------------------------------------------------

`.gitignore` should include at least the following files:

        .*
        !.gitignore
        logs
        target
        project/project
        project/target
        bin
        activator
        activator.bat
        activator-launch*

Other files may be considered for inclusion. Examples include:

        tmp
        .history
        dist
        /out
        /RUNNING_PID

<a name="appendixb"></a>Appendix B - Add/commit files to local Git repository
-----------------------------------------------------------------------------

1. `cd <directory>`
1. `git init`
1. `vi .gitignore`: [Appendix A](#appendixa) includes examples of files to be Git ignored
1. `vi README` (recommended for all GitHub repositories)
1. `vi LICENSE` (recommended for all GitHub repositories)
1. `git status`: all files should be unstaged
1. Add all files recursively: `git add .`
1. `git status`: all files should be staged
1. Commit: `git commit -m "<commit message including version>"`
1. Tag project: `git tag <tagname>` (e.g. `git tag 0.1.0`)
1. `git status`: all files should be committed i.e. on the master HEAD of the local copy

<a name="appendixc"></a>Appendix C - Create repository in GitHub
----------------------------------------------------------------

1. Create repository in GitHub:
  1. Log in GitHub
  1. New repository
  1. Name: `<repository>`
  1. Description (optional): <repository description>
  1. Public
  1. Create repository
  1. Note the repository SSH URL: `git@github.com:<user>/<repository>.git`

<a name="appendixd"></a>Appendix D - Push files from local Git repository to GitHub
-----------------------------------------------------------------------------------

1. `cd <local repository>`
1. Associate GitHub (remote) repository with local one: `git remote add origin <repository SSH URL>`
1. Push files from local repository to GitHub: `git push -u origin master`
1. Push tag to remote: `git push origin <tagname>` (e.g. `git push origin 0.1.0`)

<a name="appendixe"></a>Appendix E - Create module web page in GitHub
---------------------------------------------------------------------

1. In Github, go to the repository, press Settings and then automatic page generator
1. Copy/paste the contents of the module's `README.md` file onto the body
1. Press "Continue to layouts"
1. Select layout
1. Preview page and check that everything's ok
1. Publish page

<a name="appendixf"></a>Appendix F - Module announcement e-mail template
------------------------------------------------------------------------

```
Subject: [play-framework] [2.3.x] Play 2 <module> module
To: play-framework@googlegroups.com

The Play 2 <module> module <module description>. It has been published along with a sample application.

Website: https://<user>.github.io/play2-<module>/
Documentation: https://github.com/<user>/play2-<module>-sample/blob/master/README.md
Short description: The Play 2 <module> module <short description>.
```

References
----------

* <a href="http://www.objectify.be/wordpress/?p=363" target="_blank">Writing modules for Play 2, part 1: Get something working - Objectify</a>
* <a href="http://www.objectify.be/wordpress/?p=374" target="_blank">Writing modules for Play 2, part 2: Interceptors - Objectify</a>
* <a href="http://www.objectify.be/wordpress/?p=410" target="_blank">Publishing Play 2 modules on github - Objectify</a>
* <a href="http://stackoverflow.com/questions/25101844/how-to-define-resolver-for-dependencies-from-custom-repository-on-github" target="_blank">playframework - How to define resolver for dependencies from custom repository on GitHub? - Stack Overflow</a>